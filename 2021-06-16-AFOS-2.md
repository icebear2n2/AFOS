---
title:  "[AWS] 2주차-2 인스턴스 배포 실습"
subtitle:   "인스턴스 배포 실습"
date: 2021-06-16 23:00:00
categories: AWS
tags: AFOS[2기]
---


`VPC 대시보드` -> `VPC 마법사 시작` 클릭
<br/>

<img width="382" alt="스크린샷 2021-06-16 오후 10 45 03" src="https://user-images.githubusercontent.com/76810787/122235177-71b79500-cef8-11eb-8ca0-624b9e33ac46.png">
<br/>

`단일 퍼블릭 서브넷이 있는 VPC` -> `선택` 클릭
<br/>

<img width="1065" alt="스크린샷 2021-06-16 오후 10 45 23" src="https://user-images.githubusercontent.com/76810787/122235180-72e8c200-cef8-11eb-88e1-a37c054f3c46.png">
<br/>

차례대로 입력
<br/>
```
IPv4 CIDR 블록 : 10.20.0.0/16
VPC 이름 : SecondVPC
퍼블릭 서브넷의 IPv4 CIDR : 10.20.1.0/24
가용 영역 : ap-northeast-2a
서브넷 이름 : SecondVPC-Subnet1
```
<br/>

<img width="1390" alt="스크린샷 2021-06-16 오후 10 46 17" src="https://user-images.githubusercontent.com/76810787/122235188-754b1c00-cef8-11eb-8947-221943ed2b74.png">
<br/>

`EC2 대시보드` -> `인스턴스 시작`
<br/>

<img width="494" alt="스크린샷 2021-06-16 오후 10 47 28" src="https://user-images.githubusercontent.com/76810787/122235190-75e3b280-cef8-11eb-80fd-2cfba5d37256.png">
<br/>

**AMI 선택**
<br/>

AMI 리눅스2 `선택` 클릭
<br/>

<img width="1148" alt="스크린샷 2021-06-16 오후 10 47 42" src="https://user-images.githubusercontent.com/76810787/122235191-767c4900-cef8-11eb-8067-d0cb6421893d.png">
<br/>

**인스턴스 유형 선택**
<br/>

기본 값으로 둔 후, `다음: 인스턴스 세부 정보 구성` 클릭
<br/>

<img width="228" alt="스크린샷 2021-06-16 오후 10 47 51" src="https://user-images.githubusercontent.com/76810787/122235195-7714df80-cef8-11eb-9d34-368dbcadd301.png">
<br/>

**인스턴스 세부 구성**
<br/>

인스턴스 개수 : 1
```
네트워크 : SecondVPC
서브넷 : 'SecondVPC' 선택 시 자동으로 서브넷 선택 됨
퍼블릭 IP 자동 할당 : 활성화
```
<br/>

<img width="682" alt="스크린샷 2021-06-16 오후 10 48 17" src="https://user-images.githubusercontent.com/76810787/122235198-77ad7600-cef8-11eb-88ff-c089d5192009.png">
<br/>

하단에 **고급 세부 정보**에서 `사용자 데이터`
차례대로 입력
```
#!/bin/bash
hostnamectl --static set-hostname AFOS2-WebSrv
yum install httpd -y
systemctl start httpd && systemctl enable httpd
echo "<h1>Welcome to AFOS2 Web Server</h1>" > /var/www/html/index.html
```
<br/>

<img width="974" alt="스크린샷 2021-06-16 오후 10 48 39" src="https://user-images.githubusercontent.com/76810787/122235201-78460c80-cef8-11eb-95b5-6a65b744623a.png">
<br/>

`다음 스토리지 추가` 클릭
<br/>

<img width="177" alt="스크린샷 2021-06-16 오후 10 48 47" src="https://user-images.githubusercontent.com/76810787/122235204-78460c80-cef8-11eb-8b11-521b852b46bc.png">
<br/>

**스토리지 추가 선택**
<br/>

기본값으로 두고, `다음: 태그추가` 클릭
<br/>

<img width="132" alt="스크린샷 2021-06-16 오후 10 48 55" src="https://user-images.githubusercontent.com/76810787/122235207-78dea300-cef8-11eb-8ce8-0a2780a45a22.png">
<br/>

**태그 추가**
키 : `Name`, 값 : `WebSrv` 입력 후 `다음: 보안 그룹 구성` 클릭
<br/>

<img width="1381" alt="스크린샷 2021-06-16 오후 10 49 23" src="https://user-images.githubusercontent.com/76810787/122235208-79773980-cef8-11eb-88b3-0b2d49ee3409.png">
<br/>

**보안 그룹 구성**
<br/>

보안그룹 이름 : SecondVPC-NewSG
설명 : "
`HTTP` 규칙 추가 후 `검토 및 시작` 클릭
<br/>

<img width="1381" alt="스크린샷 2021-06-16 오후 10 50 00" src="https://user-images.githubusercontent.com/76810787/122235212-79773980-cef8-11eb-886c-ff1d00f45540.png">
<br/>

`시작하기` 클릭
<br/>

<img width="123" alt="스크린샷 2021-06-16 오후 10 50 12" src="https://user-images.githubusercontent.com/76810787/122235214-7a0fd000-cef8-11eb-9333-53501d15efb2.png">
<br/>

**키페어 선택**
<br/>

기존 키 페어 선택 후, 체크 박스 체크 -> `인스턴스 시작` 클릭
<img width="664" alt="스크린샷 2021-06-16 오후 10 50 21" src="https://user-images.githubusercontent.com/76810787/122235216-7aa86680-cef8-11eb-9f1e-1b18fd899f0c.png">
<br/>

인스턴스 퍼블릭 IP 주소 활성화 확인
<br/>

<img width="682" alt="스크린샷 2021-06-16 오후 11 31 59" src="https://user-images.githubusercontent.com/76810787/122242704-826b0980-cefe-11eb-9291-e407a207ac4b.png">
<br/>

우클릭 후에 `연결` 클릭 후
<br/>

<img width="790" alt="스크린샷 2021-06-16 오후 11 32 41" src="https://user-images.githubusercontent.com/76810787/122242716-8565fa00-cefe-11eb-97a7-64b2a0fdfc73.png">
<br/>

차례대로 입력하면 접속 완료
``` 
# 키 파일 최소 권한으로 변경
chmod 400 'ssh키파일'

# ssh 로 접속
ssh -i 'ssh키파일' ec2-user@퍼블릭IP
```
<br/>

![스크린샷 2021-06-16 오후 11 33 47](https://user-images.githubusercontent.com/76810787/122242722-86972700-cefe-11eb-90da-b0d401b96316.png)
<br/>

키가 저장된 폴더에 올릴 사진 옮겨 놓기
<br/>

![스크린샷 2021-06-16 오후 11 35 58](https://user-images.githubusercontent.com/76810787/122242723-872fbd80-cefe-11eb-83bb-62beddd73f09.png)
<br/>

```
# 아래는 맥 PC의 현재 디렉터리에 이미지.jpg 파일을 ⇒ EC2 /home/ec2-user 디렉터리에 복사 
예시) scp -i 'ssh키파일' 이미지.jpg ec2-user@퍼블릭IP:/home/ec2-user/
```
<br/>

![스크린샷 2021-06-16 오후 11 37 40](https://user-images.githubusercontent.com/76810787/122242726-87c85400-cefe-11eb-99f8-8e8c52551b59.png)
![스크린샷 2021-06-16 오후 11 39 06](https://user-images.githubusercontent.com/76810787/122242728-8860ea80-cefe-11eb-8a92-a942515d9f4c.png)
<br/>

```
# htop 설치
sudo yum -y install htop 
#htop 실행
htop
```
<br/>

![스크린샷 2021-06-16 오후 11 42 02](https://user-images.githubusercontent.com/76810787/122242732-8860ea80-cefe-11eb-9274-d3d6ef050b26.png)
<br/>

## CloudWatch 경보 생성
`CloudWatch` 검색 -> `경보` 클릭 -> `경보 생성` 클릭
<br/>

<img width="1117" alt="스크린샷 2021-06-16 오후 11 43 15" src="https://user-images.githubusercontent.com/76810787/122242735-88f98100-cefe-11eb-9050-a53211f2e2c0.png">
<br/>

`지표 선택` 클릭
<br/>

<img width="806" alt="스크린샷 2021-06-16 오후 11 43 22" src="https://user-images.githubusercontent.com/76810787/122242739-88f98100-cefe-11eb-8c47-caf956a5de8b.png">
<br/>

`EC2` 클릭
<br/>

<img width="304" alt="스크린샷 2021-06-16 오후 11 43 28" src="https://user-images.githubusercontent.com/76810787/122242742-89921780-cefe-11eb-8595-59a1b32727a9.png">
<br/>

`인스턴스별 지표` 선택
<br/>

<img width="370" alt="스크린샷 2021-06-16 오후 11 43 40" src="https://user-images.githubusercontent.com/76810787/122242745-8a2aae00-cefe-11eb-8af1-de68b1a22704.png">
<br/>

**CPUUtilization** 검색 후, 인스턴스 이름 확인 후에 체크박스 체크 !
`지표 선택` 클릭
<br/>

<img width="1184" alt="스크린샷 2021-06-16 오후 11 44 25" src="https://user-images.githubusercontent.com/76810787/122242750-8ac34480-cefe-11eb-813b-b9fccf77cc68.png">
<br/>

기간 `1분` 선택
<br/>

<img width="762" alt="스크린샷 2021-06-16 오후 11 44 57" src="https://user-images.githubusercontent.com/76810787/122242756-8b5bdb00-cefe-11eb-8163-6b6cde08afe4.png">
<br/>

**조건** 에서 차례대로 설정 -> `다음` 클릭
```
임계값 유형 : 정적
경보 조건 : 보다 큼 
...보다 : 50
누락된 데이터 처리 : 누락된 데이터를 양호(임계값 위반 안 함)(으)로 처리
```
<br/>
<img width="779" alt="스크린샷 2021-06-16 오후 11 46 20" src="https://user-images.githubusercontent.com/76810787/122242758-8b5bdb00-cefe-11eb-8e2e-c50bbb961756.png">
<br/>

<br/>

차례대로 설정 -> `주제 생성` 클릭

```
경보 상태 트리거 : 경보 상태
SNS 주제 선택 : 새 주제 생성
새 주제 생성 이름 : EC2_CPU_High_Alarms_Topic
알림을 수신할 이메일 엔드포인트: 자신의 이메일
```
<br/>

<img width="807" alt="스크린샷 2021-06-16 오후 11 48 06" src="https://user-images.githubusercontent.com/76810787/122242767-8c8d0800-cefe-11eb-837d-1d6ad03236a5.png">
<br/>

`개인 이메일함`에 가서 `Confirm subscription` 클릭
<br/>

<img width="513" alt="스크린샷 2021-06-16 오후 11 48 49" src="https://user-images.githubusercontent.com/76810787/122242771-8d259e80-cefe-11eb-9c81-05d50f0c4865.png">
<br/>

`EC2 작업 추가` 클릭 -> `경보 상태` 선택 -> `이 인스턴스 재부팅` 선택 -> `다음` 클릭
<br/>

<img width="803" alt="스크린샷 2021-06-16 오후 11 46 50" src="https://user-images.githubusercontent.com/76810787/122242761-8bf47180-cefe-11eb-88d8-e9474f6fc81d.png">
<br/>

경보 이름 : WebSrv-CPU-High-Alarm
`다음` 클릭
<br/>

<img width="816" alt="스크린샷 2021-06-16 오후 11 49 45" src="https://user-images.githubusercontent.com/76810787/122242777-8dbe3500-cefe-11eb-982c-efadfd4bf8b1.png">
<br/>

맨 하단에 `경보 생성` 클릭
<br/>

<img width="332" alt="스크린샷 2021-06-16 오후 11 49 55" src="https://user-images.githubusercontent.com/76810787/122242782-8e56cb80-cefe-11eb-8680-1fc2ddab669d.png">
<br/>

생성 완료 !
<br/>

<img width="1113" alt="스크린샷 2021-06-16 오후 11 50 18" src="https://user-images.githubusercontent.com/76810787/122242785-8e56cb80-cefe-11eb-89aa-c7d5fa44b108.png">
<br/>

**1분 간격 모니터링 설정**
<br/>

추가 비용 발생
`EC2` -> `인스턴스` 누른 후 하단에 `모니터링` 클릭 -> `세부 모니터링` 클릭
<br/>

<img width="688" alt="스크린샷 2021-06-16 오후 11 51 17" src="https://user-images.githubusercontent.com/76810787/122242789-8eef6200-cefe-11eb-92c5-998855770a0e.png">
<br/>

`활성화` 클릭 -> `저장` 클릭 
<br/>

<img width="849" alt="스크린샷 2021-06-16 오후 11 51 25" src="https://user-images.githubusercontent.com/76810787/122242790-8f87f880-cefe-11eb-816b-b802a1d13b57.png">
<br/>

**CPU 부하 툴 설치**
<br/>

```
sudo amazon-linux-extras install -y epel
sudo yum install -y stress-ng
stress-ng -h

# CPU 부하 발생

sudo stress-ng --cpu 1 --cpu-load 70% --timeout 10m --metrics --times --verify
```
<br/>

![스크린샷 2021-06-16 오후 11 53 07](https://user-images.githubusercontent.com/76810787/122242793-90208f00-cefe-11eb-800d-6efac738a299.png)
<br/>

CPU 사용량이 임계값 50이 넘으면 알람 메일이 온다
<br/>

![스크린샷 2021-06-17 오전 12 46 28](https://user-images.githubusercontent.com/76810787/122251568-95cda300-cf05-11eb-9560-c51d6f33d49c.png)
<br/>
<br/>
<br/>

## 과제 실습

리눅스 cli 창에 차례대로 입력
```
# 사진 -> html 쪽으로 옮기기
# mv 사용할 때 뒤에 sudo  꼭 붙히기 !
     sudo mv /home/ec2-user/이미지.jpg /var/www/html/

# html 파일 열기
     sudo nano /var/www/html/index.html

# 이미지 삽입
    <img src="이미지.jpg">
```
<img width="325" alt="스크린샷 2021-06-16 오후 9 28 56" src="https://user-images.githubusercontent.com/76810787/122252468-55baf000-cf06-11eb-8a2b-34766d9c393b.png">
<br/>

과제 성공 !

<br/>

<img width="1377" alt="스크린샷 2021-06-16 오후 9 23 43 복사본" src="https://user-images.githubusercontent.com/76810787/122253191-e85b8f00-cf06-11eb-8b69-1eef15acaf1d.png">
<br/>

## 실습 완료 후 인스턴스 종료 -> CloudWatch 경보 클릭 -> 작업 -> 삭제

<br/>
<br/>
<br/>

<hr/>

**참고 자료 : AFOS[2기] 노션 내용**