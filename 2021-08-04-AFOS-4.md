---
title:  "[AWS] 9주차-4 Wordpress & WooCommerce  웹서버(EFS) & AWS RDS 구성 실습"
subtitle:   "Wordpress & WooCommerce  웹서버(EFS) & AWS RDS 구성 실습"
date: 2021-08-04 24:30:00
categories: AWS
tags: AFOS[2기]
---

## 1대 EC2(EFS)와 AWS RDS(DB)로 구성 : Web/PHP 인스턴스 + AWS RDS(DB)로 구성
- WebSrv2: 10.1.1.20 + EFS(/var/www/wordpress)
- AWS RDS

RDS => `데이터베이스 생성` 클릭
<img width="471" alt="스크린샷 2021-08-04 오후 11 10 15" src="https://user-images.githubusercontent.com/87232411/128199953-ed520001-4cd2-4b77-aff2-032f6f8c82f2.png">

MySQL 선택
<img width="816" alt="스크린샷 2021-08-04 오후 11 10 28" src="https://user-images.githubusercontent.com/87232411/128199961-5582d57d-19e5-4d40-aac3-4ec2bb5d88ee.png">

프리티어
<img width="826" alt="스크린샷 2021-08-04 오후 11 10 34" src="https://user-images.githubusercontent.com/87232411/128199968-8446b398-7b5b-47dd-96c7-694f122103f1.png">

```
DB 인스턴스 식별자 : wpdb (현재 AWS 리전에서 AWS 계정이 소유하는 모든 DB 인스턴스에 대해 유일, 각자 편하게 설정)
마스터 사용자 이름 : root
마스터 암호(암호확인) : qwe12345
```
<img width="815" alt="스크린샷 2021-08-04 오후 11 11 07" src="https://user-images.githubusercontent.com/87232411/128199971-4f00a428-cf5e-4e18-86ee-a82f52f719d7.png">

`t2.micro` 선택
<img width="802" alt="스크린샷 2021-08-04 오후 11 11 16" src="https://user-images.githubusercontent.com/87232411/128199976-7dad6683-2bca-469d-80c2-6dd924823834.png">

`WP-VPC1` 선택
<img width="814" alt="스크린샷 2021-08-04 오후 11 11 31" src="https://user-images.githubusercontent.com/87232411/128199984-e4447b7b-fd99-436d-83b3-3865e11ceb6d.png">

default 제거 후 -> G3 라고 적혀있는 보안그룹 선택
<img width="602" alt="스크린샷 2021-08-04 오후 11 11 42" src="https://user-images.githubusercontent.com/87232411/128199992-c2aa63af-cf51-42fa-a11b-e0b1d4fa853d.png">
<img width="661" alt="스크린샷 2021-08-04 오후 11 11 54" src="https://user-images.githubusercontent.com/87232411/128199996-8deb987b-29af-4c00-9d4f-24aa230d8084.png">

추가구성
```
초기 데이터베이스 이름 : wordpressdb
DB 파라미터 그룹 : ##-mydbparametergroup-## 포함된것 선택
자동 백업 활성화 : Uncheck
```
<img width="798" alt="스크린샷 2021-08-04 오후 11 12 36" src="https://user-images.githubusercontent.com/87232411/128199998-96ad225c-f288-4a11-ae5c-40beafeeeb4d.png">

`데이터베이스 생성` 클릭
<img width="287" alt="스크린샷 2021-08-04 오후 11 12 49" src="https://user-images.githubusercontent.com/87232411/128200002-2e7c2389-fbc9-4776-9761-9b2224e94dd9.png">

생성 뒤 몇분 후 엔드포인트 확인 !
<img width="395" alt="스크린샷 2021-08-04 오후 11 27 55" src="https://user-images.githubusercontent.com/87232411/128200004-2723d204-1691-4074-8cd8-5db469432264.png">

## WebSrv2) EFS 확인 및 RDS 엔드포인트 주소 설정 및 확인
```bash
# 관리자 전환
sudo su -

# EFS 확인
df |grep efs
df -hT |grep efs

# RDS 엔드포인트를 변수에 지정
RDS=wpdb.cfd4iq95pfdk.ap-northeast-2.rds.amazonaws.com

# wp-config.php 파일에 DB 주소를 RDS 엔드포인트로 설정
sed -i "s/localhost/$RDS/g" /var/www/wordpress/wp-config.php

# DB 접속 테스트
mysql -h $RDS -uroot -pqwe12345 -e 'show databases;'
mysql -h $RDS -uroot -pqwe12345
```
<img width="567" alt="스크린샷 2021-08-04 오후 11 28 29" src="https://user-images.githubusercontent.com/87232411/128200006-3a9739e9-3de4-4682-89c5-6ff1ab62d3ad.png">
<img width="680" alt="스크린샷 2021-08-04 오후 11 29 04" src="https://user-images.githubusercontent.com/87232411/128200009-989abf96-a1fb-4971-8da0-d9fb977c2008.png">
<img width="527" alt="스크린샷 2021-08-04 오후 11 29 14" src="https://user-images.githubusercontent.com/87232411/128200012-7426c0b0-908c-42e7-b35f-03a4a7e7b7a3.png">
<img width="588" alt="스크린샷 2021-08-04 오후 11 29 28" src="https://user-images.githubusercontent.com/87232411/128200014-e817b58a-1ccc-4a4d-9eaa-7a3bfe3a9418.png">
<img width="596" alt="스크린샷 2021-08-04 오후 11 29 41" src="https://user-images.githubusercontent.com/87232411/128200016-9b8d8176-b933-4a1f-9ecb-30b800f638fe.png">

실습 끝!
<img width="1340" alt="스크린샷 2021-08-04 오후 11 30 34" src="https://user-images.githubusercontent.com/87232411/128200018-98b161d3-00c7-4904-9eea-2ae59907c37c.png">

## 자원 삭제(중요!)
### 1. RDS 삭제 -> 인스턴스 스냅샷 생성 여부 `언체크` -> 인정한다는 체크박스 체크 -> 삭제
### 2. CloudFormation 삭제

<br/>
<br/>
<br/>

<hr/>

**참고 자료: AFOS[2기] 노션 내용**