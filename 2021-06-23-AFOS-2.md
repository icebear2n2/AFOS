---
title:  "[AWS] 3주차-2 서브넷 VPC 구성 실습"
subtitle:   "서브넷 VPC 구성 실습"
categories: AWS
date: 2021-06-23 23:00:00
tags: AFOS[2기]
---

## 1) 퍼블릭 서브넷 VPC 생성
 
`VPC` -> `VPC 생성` 클릭
<br/>

<img width="135" alt="스크린샷 2021-06-23 오후 9 20 44" src="https://user-images.githubusercontent.com/76810787/123097802-71287c80-d46b-11eb-8fe0-522e76d2e1fc.png">
<br/>

**VPC 생성**
<br/>

```
이름 : 이름-VPC
IPv4 CIDR 블록 : 10.0.0.0/16
```
<br/>

나머지 기본값으로 나둔 후 -> `VPC 생성` 클릭
<br/>

<img width="915" alt="스크린샷 2021-06-23 오후 9 21 31" src="https://user-images.githubusercontent.com/76810787/123097809-7259a980-d46b-11eb-8801-1bfb2e337852.png">
<img width="305" alt="스크린샷 2021-06-23 오후 9 21 38" src="https://user-images.githubusercontent.com/76810787/123097814-74bc0380-d46b-11eb-8a75-da48e68f7990.png">
<br/>

`VPC` -> `서브넷` -> `서브넷 생성` 클릭
<br/>

<img width="223" alt="스크린샷 2021-06-23 오후 9 21 57" src="https://user-images.githubusercontent.com/76810787/123097816-74bc0380-d46b-11eb-9141-dcdda659fa20.png">
<br/>

**서브넷 생성**
<br/>

```
VPC ID : 생성한 VPC 선택
서브넷 이름 : 이름-Public-SN
가용영역 : ap-northeast-2a
IPv4 블록 : 10.0.0.0/24

```
<br/>

<img width="873" alt="스크린샷 2021-06-23 오후 9 22 22" src="https://user-images.githubusercontent.com/76810787/123097820-75ed3080-d46b-11eb-9235-2f27507f0d0e.png">
<img width="842" alt="스크린샷 2021-06-23 오후 9 22 58" src="https://user-images.githubusercontent.com/76810787/123097824-7685c700-d46b-11eb-87e5-4e4c4d4fad6d.png">
<br/>

`서브넷 생성` 클릭
<br/>

<img width="316" alt="스크린샷 2021-06-23 오후 9 23 03" src="https://user-images.githubusercontent.com/76810787/123097825-771e5d80-d46b-11eb-96d0-8aa9d727460d.png">
<br/>

서브넷 생성 완료 !
<br/>

<img width="1112" alt="스크린샷 2021-06-23 오후 9 23 14" src="https://user-images.githubusercontent.com/76810787/123097828-77b6f400-d46b-11eb-94bb-5463b1eb4611.png">
<br/>

`VPC` -> `인터넷 게이트웨이` -> `인터넷 게이트웨어 생성` 클릭
<br/>

<img width="292" alt="스크린샷 2021-06-23 오후 9 23 29" src="https://user-images.githubusercontent.com/76810787/123097829-77b6f400-d46b-11eb-9b3a-4e6d11710de5.png">
<br/>

**인터넷 게이트웨이 생성**
<br/>

```
이름 태그 : 이름-IGW
```
`인터넷 게이트웨어 생성` 클릭
<br/>

<img width="925" alt="스크린샷 2021-06-23 오후 9 23 45" src="https://user-images.githubusercontent.com/76810787/123097831-784f8a80-d46b-11eb-8f4c-18531adda049.png">
<br/>

인터넷 게이트웨어 생성 후 `작업` 클릭 -> `VPC 연결` 클릭 
<br/>

<img width="260" alt="스크린샷 2021-06-23 오후 9 24 01" src="https://user-images.githubusercontent.com/76810787/123097834-784f8a80-d46b-11eb-8762-4267359397ec.png">
<br/>

생성한 VPC 선택 후 -> `인터넷 게이트웨어 연결` 클릭
<br/>

<img width="851" alt="스크린샷 2021-06-23 오후 9 24 16" src="https://user-images.githubusercontent.com/76810787/123097838-78e82100-d46b-11eb-936c-a87eae53eaf7.png">
<br/>

`VPC` -> `라우팅 테이블` 클릭 -> `라우팅 테이블 생성` 클릭
<br/>

<img width="335" alt="스크린샷 2021-06-23 오후 9 29 11" src="https://user-images.githubusercontent.com/76810787/123097840-7980b780-d46b-11eb-9c7e-db584c4cd117.png">
<br/>

**라우팅 테이블 생성**
<br/>

```
이름 : 이름-Public-RT
VPC : 생성한 VPC 선택
```
`라우팅 테이블 생성` 클릭
<br/>

<img width="882" alt="스크린샷 2021-06-23 오후 9 29 32" src="https://user-images.githubusercontent.com/76810787/123097841-7a194e00-d46b-11eb-8cae-1cbf67b39323.png">
<img width="262" alt="스크린샷 2021-06-23 오후 9 29 37" src="https://user-images.githubusercontent.com/76810787/123097846-7b4a7b00-d46b-11eb-8a9c-2f13a6a422f2.png">
<br/>

라우팅 테이블 생성 완료 !
<br/>

<img width="924" alt="스크린샷 2021-06-23 오후 9 29 59" src="https://user-images.githubusercontent.com/76810787/123097850-7be31180-d46b-11eb-9d2e-940d4a92c041.png">
<br/>

생성한 퍼블릭 라우팅 테이블 클릭 후 -> `서브넷 연결` 클릭 -> `서브넷 연결 편집` 클릭
<br/>

<img width="992" alt="스크린샷 2021-06-23 오후 9 30 28" src="https://user-images.githubusercontent.com/76810787/123097851-7c7ba800-d46b-11eb-8295-aaf1106c6553.png">
<br/>

**서브넷 연결 편집**
<br/>

`생성한 퍼블릭 서브넷` 클릭 후 -> `Save associations` 클릭
<br/>

<img width="1347" alt="스크린샷 2021-06-23 오후 9 30 38" src="https://user-images.githubusercontent.com/76810787/123097855-7dacd500-d46b-11eb-9926-700810e7f6c4.png">
<br/>

다시 생성한 퍼블릭 라우팅 클릭 -> `라우팅` 클릭 -> `라우팅 편집` 클릭
<br/>

<img width="1024" alt="스크린샷 2021-06-23 오후 9 31 07" src="https://user-images.githubusercontent.com/76810787/123097857-7e456b80-d46b-11eb-9c17-e4e47a4d5910.png">
<br/>

```
Destination : 0.0.0.0/0
Target : Internet-gateway
```
`변경사항 저장` 클릭
<br/>

<img width="1349" alt="스크린샷 2021-06-23 오후 9 31 39" src="https://user-images.githubusercontent.com/76810787/123097861-7ede0200-d46b-11eb-9f6f-6445d01cde75.png">
<br/>

`EC2` 클릭 -> `인스턴스` -> `인스턴스 시작` 클릭
<br/>

<img width="302" alt="스크린샷 2021-06-23 오후 9 31 58" src="https://user-images.githubusercontent.com/76810787/123097864-7f769880-d46b-11eb-9bc2-06cb0895f7a4.png">
<br/>

**AMI 선택**
<br/>

`Linux 2` 클릭 후 `선택` 클릭
<br/>

<img width="1159" alt="스크린샷 2021-06-23 오후 9 32 06" src="https://user-images.githubusercontent.com/76810787/123097865-7f769880-d46b-11eb-8e68-65039f7796ff.png">
<br/>

**인스턴스 유형 선택**
<br/>

기본 값 -> `다음: 인스턴스 세부 정보 구성` 클릭
<br/>

<img width="234" alt="스크린샷 2021-06-23 오후 9 32 15" src="https://user-images.githubusercontent.com/76810787/123097867-800f2f00-d46b-11eb-9134-afd950e88a70.png">
<img width="716" alt="스크린샷 2021-06-23 오후 9 32 33" src="https://user-images.githubusercontent.com/76810787/123097868-800f2f00-d46b-11eb-821f-a20db9463779.png">
<br/>

**인스턴스 세부 정보 구성**
<br/>

```
네트워크 : 생성한 VPC 선택
서브넷 : 퍼블릭 서브넷 선택
퍼블릭 IP 자동 할당 : 활성화
```
나머지 기본 값으로 나둔 후 -> `다음: 스토리지 추가` 클릭
<br/>

<img width="172" alt="스크린샷 2021-06-23 오후 9 32 47" src="https://user-images.githubusercontent.com/76810787/123097870-80a7c580-d46b-11eb-957d-b6bf5ef97fdd.png">
<br/>

**스토리지 추가**
<br/>

기본 값 -> "다음: 태그 추가` 클릭
<br/>

<img width="147" alt="스크린샷 2021-06-23 오후 9 32 55" src="https://user-images.githubusercontent.com/76810787/123097879-81405c00-d46b-11eb-9003-4df453dd3eab.png">
<br/>

**태그 추가**
<br/>

```
키 : Name
값 : Public-EC2
```
`검토 및 시작` 클릭
<br/>

<img width="132" alt="스크린샷 2021-06-23 오후 9 33 31" src="https://user-images.githubusercontent.com/76810787/123097883-82718900-d46b-11eb-9150-85734da828d5.png">
<br/>

`시작하기` 클릭
<br/>

<img width="114" alt="스크린샷 2021-06-23 오후 9 33 39" src="https://user-images.githubusercontent.com/76810787/123097888-830a1f80-d46b-11eb-9625-1393e07dc99e.png">
<br/>

체크박스 선택 후 -> `인스턴스 시작` 클릭
<br/>

<img width="672" alt="스크린샷 2021-06-23 오후 9 33 53" src="https://user-images.githubusercontent.com/76810787/123097890-830a1f80-d46b-11eb-8e9f-205ff6bcc550.png">
<br/>

인스턴스 생성 완료 !
<br/>

<img width="670" alt="스크린샷 2021-06-23 오후 9 34 38" src="https://user-images.githubusercontent.com/76810787/123097894-83a2b600-d46b-11eb-937b-5703d52e0bab.png">
<br/>

생성한 인스턴스 클릭 후 -> `연결` 클릭 -> `SSH 클라이언트` 클릭 후 명령어 복사
<br/>

<img width="106" alt="스크린샷 2021-06-23 오후 9 34 56" src="https://user-images.githubusercontent.com/76810787/123097896-843b4c80-d46b-11eb-8092-2ef4a3824c34.png">
<img width="384" alt="스크린샷 2021-06-23 오후 9 35 03" src="https://user-images.githubusercontent.com/76810787/123097899-84d3e300-d46b-11eb-9961-5a5267e037e7.png">
<br/>

터미널을 킨 후, Key 파일이 있는 폴더 경로로 들어가 아까 복사한 명령어를 넣어주면 접속 완료 !
<br/>

<img width="419" alt="스크린샷 2021-06-23 오후 9 35 35" src="https://user-images.githubusercontent.com/76810787/123097902-856c7980-d46b-11eb-871f-e763b4624377.png">
<br/>

```
#네트워크 인터페이스 확인
ip -br -c addr show
or
ifconfig # 이제 이 명령어 쓰면 아재라네요.. ㅠ
```
<br/>

<img width="535" alt="스크린샷 2021-06-23 오후 9 37 15" src="https://user-images.githubusercontent.com/76810787/123097911-869da680-d46b-11eb-8a3f-80dd2f67f57f.png">
<br/>

```
# 구글로 ping 가는 지 확인
ping 8.8.8.8
```
<br/>

<img width="407" alt="스크린샷 2021-06-23 오후 9 36 53" src="https://user-images.githubusercontent.com/76810787/123097909-869da680-d46b-11eb-8efe-064978fc59c7.png">
<br/>

```
# 외부 접속 시 공인IP 정보 확인
curl ipinfo.io
```
<br/>

<img width="543" alt="스크린샷 2021-06-23 오후 9 36 25" src="https://user-images.githubusercontent.com/76810787/123097906-856c7980-d46b-11eb-995f-80e40477ddce.png">
<br/>

마지막으로 퍼블릭 테이블까지 캡쳐하면 첫번째 실습 끝 !
<br/>

<img width="1102" alt="스크린샷 2021-06-23 오후 9 37 55" src="https://user-images.githubusercontent.com/76810787/123097915-87363d00-d46b-11eb-9efd-289dd866e145.png">
<br/>

## 2) 프라이빗 서브넷 VPC 구성

`VPC` -> `서브넷` -> `서브넷 생성` 클릭
<img width="292" alt="스크린샷 2021-06-23 오후 10 25 18" src="https://user-images.githubusercontent.com/76810787/123106331-82758700-d473-11eb-9e96-428057e6a713.png">
<br/>

**서브넷 생성**
<br/>

```
VPC ID : 생성한 VPC 선택
서브넷 이름 : 이름-Private-SN
가용영역 : ap-northeast-2c
IPv4 블록 : 10.0.1.0/24
```
`서브넷 생성` 클릭
<br/>

<img width="881" alt="스크린샷 2021-06-23 오후 10 25 27" src="https://user-images.githubusercontent.com/76810787/123106334-843f4a80-d473-11eb-98cf-955c560d7b8e.png">
<img width="827" alt="스크린샷 2021-06-23 오후 10 26 06" src="https://user-images.githubusercontent.com/76810787/123106338-86090e00-d473-11eb-9d38-ba4b809edf34.png">
<br/>

프라이빗 서브넷 생성 완료 !
<br/>

<img width="1095" alt="스크린샷 2021-06-23 오후 10 26 19" src="https://user-images.githubusercontent.com/76810787/123106343-86a1a480-d473-11eb-81d9-4dc6e907b938.png">
<br/>

`VPC` -> `NAT 게이트웨이` 클릭 -> `NAT 게이트웨이 생성` 클릭
<br/>

<img width="323" alt="스크린샷 2021-06-23 오후 10 26 30" src="https://user-images.githubusercontent.com/76810787/123106344-873a3b00-d473-11eb-90a8-b018fd2819fa.png">
<br/>

**NAT 게이트웨이 생성**
<br/>

```
이름 : 이름-NAT
서브넷 : 퍼블릭 서브넷
탄력적 IP 할당 : `탄력적 IP 할당` 클릭
```
`NAT 게이트웨이 생성` 클릭
<br/>

<img width="705" alt="스크린샷 2021-06-23 오후 10 27 11" src="https://user-images.githubusercontent.com/76810787/123106345-873a3b00-d473-11eb-8fa1-f7c994bfb2f9.png">
<img width="784" alt="스크린샷 2021-06-23 오후 10 27 24" src="https://user-images.githubusercontent.com/76810787/123106346-87d2d180-d473-11eb-9f8d-63a6198fb5e5.png">
<img width="304" alt="스크린샷 2021-06-23 오후 10 27 33" src="https://user-images.githubusercontent.com/76810787/123106348-886b6800-d473-11eb-9511-91d79ea4fa2d.png">
<br/>

`VPC` -> `라우팅 테이블` 클릭 -> `라우팅 테이블 생성` 클릭
<br/>

<img width="227" alt="스크린샷 2021-06-23 오후 10 27 45" src="https://user-images.githubusercontent.com/76810787/123106351-886b6800-d473-11eb-8c0a-dfa538a1e9be.png">
<br/>

**라우팅 테이블 생성**
<br/>

```
이름 : 이름-Private-RT
VPC : 생성한 VPC 선택
```
`라우팅 테이블 생성` 클릭
<br/>

<img width="859" alt="스크린샷 2021-06-23 오후 10 28 07" src="https://user-images.githubusercontent.com/76810787/123106354-8903fe80-d473-11eb-9332-9524749b66fb.png">
<br/>

생성한 프라이빗 라우팅 테이블 클릭 후 -> `서브넷 연결` 클릭 -> `서브넷 연결 편집` 클릭
<br/>

<img width="947" alt="스크린샷 2021-06-23 오후 10 28 36" src="https://user-images.githubusercontent.com/76810787/123106356-8903fe80-d473-11eb-9ea0-5a39d9f6fed5.png">
<br/>

**서브넷 연결 편집**
<br/>

`생성한 프라이빗 서브넷` 클릭 후 -> `Save associations` 클릭
<br/>

<img width="1345" alt="스크린샷 2021-06-23 오후 10 28 50" src="https://user-images.githubusercontent.com/76810787/123106357-899c9500-d473-11eb-8037-6523d222116b.png">
<br/>

다시 생성한 프라이빗 라우팅 클릭 -> `라우팅` 클릭 -> `라우팅 편집` 클릭
<br/>

<img width="1039" alt="스크린샷 2021-06-23 오후 10 29 09" src="https://user-images.githubusercontent.com/76810787/123106359-8a352b80-d473-11eb-9a40-c8ab1145446f.png">
<br/>

```
Destination : 0.0.0.0/0
Target : NAT-gateway
```
`변경사항 저장` 클릭
<br/>

<img width="1339" alt="스크린샷 2021-06-23 오후 10 29 24" src="https://user-images.githubusercontent.com/76810787/123106361-8acdc200-d473-11eb-884e-8bfc61497721.png">
<br/>

**인스턴스 설정**
<br/>

전부 퍼블릭 인스턴스와 설정이 같고, `인스턴스 세부 구성`, `태그 추가` 부분만 다르다
<br/>

**인스턴스 세부 구성**
<br/>

```
네트워크 : 생성한 VPC
서브넷 : Private 서브넷
퍼블릭 IP 자동 할당 : 비활성화
```
<br/>

<img width="747" alt="스크린샷 2021-06-23 오후 10 30 50" src="https://user-images.githubusercontent.com/76810787/123106364-8acdc200-d473-11eb-8c45-b02a4621554d.png">
<br/>

하단에 `고급 세부 정보`에서 사용자 데이터에 작성
```
#!/bin/bash
(
echo "qwe123"
echo "qwe123"
) | passwd --stdin root
sed -i "s/^PasswordAuthentication no/PasswordAuthentication yes/g" /etc/ssh/sshd_config
sed -i "s/^#PermitRootLogin yes/PermitRootLogin yes/g" /etc/ssh/sshd_config
service sshd restart
```
 `다음: 스토리지 추가` 클릭
 <br/>

<img width="1377" alt="스크린샷 2021-06-23 오후 10 32 38" src="https://user-images.githubusercontent.com/76810787/123106372-8bfeef00-d473-11eb-8bcf-04ab20f3fe17.png">
<br/>

**태그 추가**

```
키 : Name
값 : Private-EC2
```

`검토 및 시작` 클릭
<br/>

<img width="1378" alt="스크린샷 2021-06-23 오후 10 31 12" src="https://user-images.githubusercontent.com/76810787/123106368-8b665880-d473-11eb-9738-982202e7eea4.png">
<br/>

퍼블릭 주소를 확인해보면 프라이빗 인스턴스에는 없다는 걸 볼 수 있다
<br/>

<img width="580" alt="스크린샷 2021-06-23 오후 10 33 37" src="https://user-images.githubusercontent.com/76810787/123106376-8bfeef00-d473-11eb-8c01-758153b6d334.png">
<br/>

퍼블릭 인스턴스에서 `ssh root@프라이빗 주소`를 입력하면 접속 완료 !
<br/>

<img width="565" alt="스크린샷 2021-06-23 오후 10 34 48" src="https://user-images.githubusercontent.com/76810787/123106377-8c978580-d473-11eb-80cf-59c6e8ec1624.png">
<br/>

```
#네트워크 인터페이스 확인
ip -br -c addr show
or
ifconfig # 이제 이 명령어 쓰면 아재라네요.. ㅠ
```
<br/>

<img width="548" alt="스크린샷 2021-06-23 오후 10 35 25" src="https://user-images.githubusercontent.com/76810787/123106382-8d301c00-d473-11eb-9b1e-81615d79c64d.png">
<br/>

```
# 구글로 ping 가는 지 확인
ping 8.8.8.8
```
<br/>

<img width="408" alt="스크린샷 2021-06-23 오후 10 35 44" src="https://user-images.githubusercontent.com/76810787/123106384-8d301c00-d473-11eb-8d8c-4d7d63df50e5.png">
<br/>

```
# 외부 접속 시 공인IP 정보 확인
curl ipinfo.io
```
<br/>

<img width="519" alt="스크린샷 2021-06-23 오후 10 36 08" src="https://user-images.githubusercontent.com/76810787/123106385-8dc8b280-d473-11eb-904f-7bf8bb00a3f5.png">
<br/>

마지막으로 프라이빗 테이블까지 캡쳐하면 과제 완료 !
<img width="1085" alt="스크린샷 2021-06-23 오후 10 36 37" src="https://user-images.githubusercontent.com/76810787/123106390-8dc8b280-d473-11eb-95c1-ca3e22531989.png">
<br/>
<br/>
<br/>

## 자원 삭제 (중요!)
### 1. EC2 인스턴스 종료 (EC2 → 인스턴스 → 인스턴스 선택 → 작업 → 인스턴스 상태 → 종료)

### 2. NAT 게이트웨이 삭제 (VPC → NAT 게이트웨이 → 작업 → NAT 게이트웨이 삭제)

### 3. 탄력적 IP 삭제 (VPC → 탄력적 IP → Actions → 탄력적 IP 주소 **릴리스**)

### 4. VPC 삭제 (VPC → VPC → 작업 → VPC 삭제)

<br/>
<br/>
<br/>

<hr/>

**참고 자료 : AFOS[2기] 노션 내용**