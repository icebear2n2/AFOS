---
title:  "[AWS] 7주차-4 실습 문제 풀기"
subtitle:   "실습 문제 풀기"
date: 2021-07-22 03:00:00
categories: AWS
tags: AFOS[2기]
---

### curl $EC21/xff.php 출력 IP 정보들은 무엇일까?
- Last Client IP: MyEC2 인스턴스의 퍼블릭 IP
- Server Public IP = ELB-1  인스턴스의 퍼블릭 IP
- Server Private IP = ELB-2 인스턴스의 프라이빗 IP

### for i in {1..20}; do curl $ALB --silent ; done | sort | uniq -c | sort -nr 출력 결과는 왜?
- 사진을 보면 두 인스턴스의 트래픽이 10씩 나누어져 전송되고 있다. 이와 같이 로드 밸런싱을 사용하면 양쪽으로 트래픽을 골고루 배분하여 전송 할 수 있다.

### curl $ALB/dev/index.html --silent 실행 반복 시 출력 결과 차이점과 원인과 해결방안? (curl $ALB/mgt/index.html --silent 상동)
- dev 페이지가 잘 나오다가, 오류가 난다. 해결 방안으로 경로 기반 라우팅을 예로 들 수 있다.  
- 경로 기반 라우팅 기능은 HTTP 접근을 위한 URL 경로 정보를 확인하여 원하는 대상으로 라우팅 할 수 있는 기능이다.
- dev 페이지는 ELB-1, mgt 페이지는 ELB-2 로만 전달하는 경로 기반 라우팅을 설정하면 된다.

### curl $ALB/xff.php ;echo 실행 반복 시 출력 결과 차이점과 원인과 해결방안?
- 각각 출력 결과의 Server Private IP가 다르다.
- 정답은 아닌 거 같지만 경로 기반 라우팅을 예로 들 수 있다.
- 리스너 규칙에 경로 값을 /xff.php로 설정하고 만약 전달 대상을 Dev-Group 으로 경로 기반 라우팅을 설정했다면, EC2-ELB-1 의 xff.php만 보인다.

```
# curl 접속 테스트
# NLB 는 5 Tuple Hash 결과로 분산하며 default 설정이 Cross Zone Load Balancing(교차 영역 로드 밸런싱)이 비활성화 상태 
for i in {1..20}; do snmpget -v2c -c public $NLB 1.3.6.1.2.1.1.5.0 ; done | sort | uniq -c | sort -nr
for i in {1..20}; do snmpget -v2c -c public $NLB1 1.3.6.1.2.1.1.5.0 ; done | sort | uniq -c | sort -nr
for i in {1..20}; do snmpget -v2c -c public $NLB2 1.3.6.1.2.1.1.5.0 ; done | sort | uniq -c | sort -nr
```
### 위 for $NLB 와 $NLB1, $NLB2 동작의 차이점은 왜그런건가요?
- NLB는 
- NLB1 이나 NLB2의 결과는 교차 영역 로드 밸런싱을 비활성화 해놓았기 때문에 해당 가용 영역에 있는 등록된 대상 간에만 트래픽을 분산했다.

<br/>
<br/>
<br/>

<hr/>

**참고 자료 : AFOS[2기] 노션 내용, [도서] 따라하며 배우는 AWS 네트워크 입문-chapter5A**