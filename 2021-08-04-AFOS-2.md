---
title:  "[AWS] 9주차-2 Wordpress & WooCommerce 단일서버 구성 실습"
subtitle:   "Wordpress & WooCommerce 단일서버 구성 실습"
date: 2021-08-04 23:00:00
categories: AWS
tags: AFOS[2기]
---

## [1안] 단일 서버 구성

## 1대의 인스턴스에 Web + PHP +DB 구성
AllnOne: 10.1.1.100

## Wordpress v5.8 설치 전 준비 사항(권고)
- 웹서버: Apache HTTPD 2.4.x 혹은 nginx 1.20/1.19
- PHP v7.3 이상 -> Extensions 설치
- MySQL v5.7 이상 혹은 MariaDB v10.2 이상

### CloudFormation 스택 생성
https://console.aws.amazon.com/cloudformation/home?region=ap-northeast-2#/stacks/new?stackName=WPLab&templateURL=https:%2F%2Fs3.ap-northeast-2.amazonaws.com%2Fcloudformation.cloudneta.net%2FWordpress%2Faws-wordpress-db2.yaml

`다음` 클릭
<img width="1033" alt="스크린샷 2021-08-04 오후 9 20 47" src="https://user-images.githubusercontent.com/87232411/128187539-a95d8421-3923-4595-b12c-a160ac21983d.png">

t2.micro 는 WooCommerce 플러그인 설치 시 메모리 부족 등으로 설치 시 메모리 부족 등으로 설치 자체가 제대로 진행이 되지 않는다

그러므로 설치가 가능한 최소의 성능인 t3.medium로 배포가 된다
**1시간당 60원 정도의 비용이 부가된다**
<img width="360" alt="스크린샷 2021-08-04 오후 9 20 56" src="https://user-images.githubusercontent.com/87232411/128187540-9131cd7b-baff-4cf0-a6be-81106e2b6600.png">

`Keyname` 선택 후 `다음` 클릭
<img width="1042" alt="스크린샷 2021-08-04 오후 9 21 02" src="https://user-images.githubusercontent.com/87232411/128187543-4845d204-7858-4386-9288-ee96b393ade3.png">

`다음` 클릭
<img width="355" alt="스크린샷 2021-08-04 오후 9 21 10" src="https://user-images.githubusercontent.com/87232411/128187547-3f7178c6-a9ec-4201-a758-30730e741ddf.png">

`스택 생성` 클릭
<img width="262" alt="스크린샷 2021-08-04 오후 9 21 15" src="https://user-images.githubusercontent.com/87232411/128187551-81821290-3571-4e34-aed4-4e1de440e729.png">

### 웹서버 설치

```bash
# 관리자 전환
sudo su -

# 설치
yum install httpd -y

# 서비스 실행
systemctl start httpd && systemctl enable httpd

# 웹서버 버전 확인
httpd -v

# 웹 접속하여 확인
http://EC2_PublicIP/
```
<img width="370" alt="스크린샷 2021-08-04 오후 9 23 39" src="https://user-images.githubusercontent.com/87232411/128187555-73bd1895-4b8c-42db-8688-d5f30cfca860.png">
<img width="573" alt="스크린샷 2021-08-04 오후 9 23 56" src="https://user-images.githubusercontent.com/87232411/128187556-e3633025-747d-4a6a-a1af-ea0858d6ada3.png">
<img width="275" alt="스크린샷 2021-08-04 오후 9 24 11" src="https://user-images.githubusercontent.com/87232411/128187558-8312e617-5ef7-4372-ba13-a2e06e014f26.png">

Test page가 생성된 걸 볼 수 있다
<img width="1369" alt="스크린샷 2021-08-04 오후 9 24 24" src="https://user-images.githubusercontent.com/87232411/128187562-a4f0ab5e-9158-4dfa-99cd-e9406caa850c.png">

### PHP설치 -> PHP Extensions 설치

```bash
# 설치
amazon-linux-extras install php7.4 -y

# PHP 버전 확인
php -v

# PHP Extensions 설치
yum install gcc php-xml php-mbstring php-sodium php-devel php-pear ImageMagick-devel ghostscript -y

# PHP Extensions 정보 확인
php --ini

# PHP Extensions - imagick 설치
## imagick 관련 ini 파일 생성
cat <<EOT> /etc/php.d/40-imagick.ini
; Enable imagick extension module
extension = imagick.so
EOT

## pecl 로 imagick 설치
printf "\n" | pecl install imagick

# php-fpm 재시작으로 imagick 적용
systemctl restart php-fpm
systemctl restart httpd

# PHP Extensions 정보 확인
php --ini

# php info 페이지 생성
echo "<?php phpinfo(); ?>" > /var/www/html/info.php

# phpinfo.php 웹 접속하여 확인
http://EC2_PublicIP/info.php
```
<img width="514" alt="스크린샷 2021-08-04 오후 9 25 22" src="https://user-images.githubusercontent.com/87232411/128187568-262a407e-65da-4e74-b02b-f2316890ca40.png">
<img width="448" alt="스크린샷 2021-08-04 오후 9 25 32" src="https://user-images.githubusercontent.com/87232411/128187571-70f1aed8-95c6-4ff1-97e6-5a8fbb72e394.png">
<img width="402" alt="스크린샷 2021-08-04 오후 9 27 06" src="https://user-images.githubusercontent.com/87232411/128187574-0f56364c-88cf-420d-922a-79e9618c8541.png">
<img width="431" alt="스크린샷 2021-08-04 오후 9 27 21" src="https://user-images.githubusercontent.com/87232411/128187576-08dbe0cb-7fa3-4824-9c2c-945698434018.png">
<img width="594" alt="스크린샷 2021-08-04 오후 9 27 52" src="https://user-images.githubusercontent.com/87232411/128187581-868d69c1-ff47-4e28-bd0e-48b87545f278.png">
<img width="454" alt="스크린샷 2021-08-04 오후 9 28 51" src="https://user-images.githubusercontent.com/87232411/128187583-0246b39f-5729-4b07-a04c-e10145fc17ab.png">
<img width="539" alt="스크린샷 2021-08-04 오후 9 35 30" src="https://user-images.githubusercontent.com/87232411/128187604-cbc078bb-f0ac-47c7-9d10-78ff40db5f19.png">

info.php 페이지가 만들어졌다
<img width="1366" alt="스크린샷 2021-08-04 오후 9 29 14" src="https://user-images.githubusercontent.com/87232411/128187589-1293e127-9e3f-4764-b7bd-00e8ea393022.png">

memory_limit는 128M이다
<img width="446" alt="스크린샷 2021-08-04 오후 9 32 47" src="https://user-images.githubusercontent.com/87232411/128187595-74ea230c-921c-46c1-a037-eb026c177f3a.png">

### 옵션) 2M 이상 크기 파일 업로드 관련 설정 및 메모리 상향 설정 -> Woocommerce 설치 시 필요

```bash
# php.ini 파일 수정
sed -i 's/^upload_max_filesize = 2M/upload_max_filesize = 64M/g' /etc/php.ini
sed -i 's/^post_max_size = 8M/post_max_size = 64M/g' /etc/php.ini
sed -i 's/^max_execution_time = 30/max_execution_time = 300/g' /etc/php.ini
sed -i 's/^memory_limit = 128M/memory_limit = 256/g' /etc/php.ini

# php-fpm 재시작으로 적용
systemctl restart php-fpm
```
<img width="597" alt="스크린샷 2021-08-04 오후 9 34 05" src="https://user-images.githubusercontent.com/87232411/128187597-edf15904-db8f-4df8-bcbc-2434125bc067.png">

memory_limit가 128M에서 256M로 늘어났다
<img width="409" alt="스크린샷 2021-08-04 오후 9 34 14" src="https://user-images.githubusercontent.com/87232411/128187601-11794571-a697-4f8a-8df7-01f0f2dc4998.png">

### 옵션) phpMyAdmin 설치 (실패했으니 제 게시물 말고, 직접 사이트 들어가서 맨 처음부터 실습하시는 걸 추천합니다.)

https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ec2-lamp-amazon-linux-2.html#install-phpmyadmin-lamp-server

phpMyAdmin은 EC2 인스턴스의 MySQL 데이터베이스를 보고 편집하는 데 사용할 수 있는 웹 기반 데이터베이스 관리 도구이다.
```bash
# 필요한 종속 항목 설치
sudo yum install php-mbstring php-xml -y

# Apache를 다시 시작
sudo systemctl restart httpd

#php-fpm 를 다시 시작
sudo systemctl restart php-fpm

## Apache 문서 루트로 이동
cd /var/www/html

# phpMyAdmin 최신 릴리스의 소스 패키지 설치
wget https://www.phpmyadmin.net/downloads/phpMyAdmin-latest-all-languages.tar.gz

# phpMyAdmin 폴더를 생성하고 다음 명령을 사용하여 해당 폴더로 패키지의 압축을 푼다
mkdir phpMyAdmin && tar -xvzf phpMyAdmin-latest-all-languages.tar.gz -C phpMyAdmin --strip-components 1

# 압축 파일 삭제
rm phpMyAdmin-latest-all-languages.tar.gz

# 사이트 접속
http://my.public.dns.amazonaws.com/phpMyAdmin

```
<img width="444" alt="스크린샷 2021-08-04 오후 9 37 49" src="https://user-images.githubusercontent.com/87232411/128187606-aefeedd9-0cb4-4de1-8577-b3b4485f296f.png">
<img width="383" alt="스크린샷 2021-08-04 오후 9 38 07" src="https://user-images.githubusercontent.com/87232411/128187609-24e36e26-bfb4-4075-82b3-a7198e46e8ac.png">
<img width="352" alt="스크린샷 2021-08-04 오후 9 38 27" src="https://user-images.githubusercontent.com/87232411/128187611-e90777a6-6b67-413c-a24c-6ee94469d60c.png">
<img width="304" alt="스크린샷 2021-08-04 오후 9 38 43" src="https://user-images.githubusercontent.com/87232411/128187614-48756d15-1034-46a2-a41a-23470cbf231a.png">
<img width="594" alt="스크린샷 2021-08-04 오후 9 39 03" src="https://user-images.githubusercontent.com/87232411/128187616-f6f33ec8-9c16-473c-a0eb-32a107ad7e84.png">
<img width="593" alt="스크린샷 2021-08-04 오후 9 39 39" src="https://user-images.githubusercontent.com/87232411/128187619-07942b1d-125f-4abd-8939-b3a0cfe5d874.png">
<img width="497" alt="스크린샷 2021-08-04 오후 9 39 52" src="https://user-images.githubusercontent.com/87232411/128187623-30fe6d5c-c1ba-44b6-9bad-5edb6b32e563.png">

음.. 접속이 안 된다
<img width="1129" alt="스크린샷 2021-08-04 오후 9 54 12" src="https://user-images.githubusercontent.com/87232411/128187627-c904927f-f308-4e69-8546-704293a042e0.png">

파일은 있는데 ...
<img width="213" alt="스크린샷 2021-08-04 오후 9 54 21" src="https://user-images.githubusercontent.com/87232411/128187628-7b04a499-4829-467b-bb48-09074725bfca.png">

디렉터리 안에 페이지는 들어가지는데 보이진 않는다.

내 개인적인 생각으로 지금 인스턴스에 Mysql이 설치가 안 되어 있는 것도 관련있는 것 같다. 다음 기회에 !
<img width="634" alt="스크린샷 2021-08-04 오후 9 56 02" src="https://user-images.githubusercontent.com/87232411/128187629-740a633e-2303-4abd-a9c0-ddebfaf6c283.png">

### MariaDB 설치

```bash
# 설치
amazon-linux-extras install mariadb10.5 -y

# 서비스 시작
systemctl start mariadb && systemctl enable mariadb

# DB root 계정 설정 및 권장 설정
echo -e "\n Y\n n\n Y\n Y\n Y\n Y\n" | /usr/bin/mysql_secure_installation


# DB 에 한글 입력을 위한 설정
sed -i'' -r -e "/\[mysqld\]/a\character-set-server=utf8" /etc/my.cnf.d/mariadb-server.cnf
sed -i'' -r -e "/\[mysqld\]/a\collation-server=utf8_general_ci" /etc/my.cnf.d/mariadb-server.cnf
sed -i'' -r -e "/\[mysqld\]/a\init_connect=\"SET NAMES utf8\"" /etc/my.cnf.d/mariadb-server.cnf
sed -i'' -r -e "/\[mysqld\]/a\init_connect=\"SET collation_connection = utf8_general_ci\"" /etc/my.cnf.d/mariadb-server.cnf
sed -i'' -r -e "/\[client\]/a\default-character-set=utf8" /etc/my.cnf.d/client.cnf
sed -i'' -r -e "/\[mysql\]/a\default-character-set=utf8" /etc/my.cnf.d/mysql-clients.cnf
sed -i'' -r -e "/\[mysqldump\]/a\default-character-set=utf8" /etc/my.cnf.d/mysql-clients.cnf

# root 계정을 외부에서도 접속 가능하게 설정
mysql -e "set password = password('qwe123');"
mysql -uroot -pqwe123 -e "GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'qwe123';"

# wordpressdb 데이터베이스 생성 및 확인
mysql -uroot -pqwe123 -e "CREATE DATABASE wordpressdb"
mysql -uroot -pqwe123 -e "show databases;"

# 서비스 재시작
systemctl restart mariadb

# 버전 확인
mysql --version

```

<img width="553" alt="스크린샷 2021-08-04 오후 9 57 40" src="https://user-images.githubusercontent.com/87232411/128187630-48c02094-e6c4-4317-8bc1-eb8e0adff99f.png">
<img width="597" alt="스크린샷 2021-08-04 오후 9 58 16" src="https://user-images.githubusercontent.com/87232411/128187634-0adc49ac-2880-412a-9ab8-3a68e100ea94.png">
<img width="600" alt="스크린샷 2021-08-04 오후 9 58 44" src="https://user-images.githubusercontent.com/87232411/128187639-d9422701-46f2-480b-a821-3148203c7f42.png">
<img width="594" alt="스크린샷 2021-08-04 오후 9 59 01" src="https://user-images.githubusercontent.com/87232411/128187641-23891b5f-6c3e-4189-8dfb-ac69184ba207.png">
<img width="592" alt="스크린샷 2021-08-04 오후 10 01 51" src="https://user-images.githubusercontent.com/87232411/128187650-6dc7725a-d0f3-4862-87f5-ee8bb2897b61.png">
<img width="585" alt="스크린샷 2021-08-04 오후 10 02 03" src="https://user-images.githubusercontent.com/87232411/128187652-5bf6648a-7e7f-4115-a3c7-c4f5929865e6.png">
<img width="595" alt="스크린샷 2021-08-04 오후 10 02 33" src="https://user-images.githubusercontent.com/87232411/128187655-7a9696b0-bc26-40ee-858b-fb1d9509011e.png">

### Wordpress v5.8 설치

```bash
# 다운로드 (둘 중 아무거나)
wget https://ko.wordpress.org/wordpress-latest-ko_KR.zip
wget https://ko.wordpress.org/wordpress-5.8-ko_KR.zip

# 압축 풀기
unzip wordpress-latest-ko_KR.zip

# wp-config.php 파일 복사
cp wordpress/wp-config-sample.php wordpress/wp-config.php

# wp-config.php 파일에 db 접속을 위한 정보 입력
sed -i "s/database_name_here/wordpressdb/g" wordpress/wp-config.php
sed -i "s/username_here/root/g" wordpress/wp-config.php
sed -i "s/password_here/qwe123/g" wordpress/wp-config.php

# wp-config.php 파일에 메모리 상향 설정
cat <<EOT>> wordpress/wp-config.php
define('WP_MEMORY_LIMIT', '256M');
EOT

# 압축 푼 wordpress 파일을 웹 디렉터리에 복사
cp -r wordpress/* /var/www/html/

# 사용자와 권한 설정
chown -R apache /var/www
chgrp -R apache /var/www
chmod 2775 /var/www
find /var/www -type d -exec chmod 2775 {} \;
find /var/www -type f -exec chmod 0664 {} \;

# 서비스 재시작
systemctl restart httpd
```
<img width="597" alt="스크린샷 2021-08-04 오후 10 02 52" src="https://user-images.githubusercontent.com/87232411/128187657-b7ce35b6-33e2-4ad8-8c5f-563314e7286e.png">
<img width="561" alt="스크린샷 2021-08-04 오후 10 04 27" src="https://user-images.githubusercontent.com/87232411/128187658-caecc254-761c-4caa-b532-3d7b1b86b173.png">
<img width="596" alt="스크린샷 2021-08-04 오후 10 04 40" src="https://user-images.githubusercontent.com/87232411/128187661-c9e0220a-31c2-4e52-a1d2-31083c912f3f.png">
<img width="439" alt="스크린샷 2021-08-04 오후 10 04 52" src="https://user-images.githubusercontent.com/87232411/128187662-de257572-69d4-4a61-b0c9-7c14f9aa3b64.png">
<img width="487" alt="스크린샷 2021-08-04 오후 10 05 42" src="https://user-images.githubusercontent.com/87232411/128187663-76ba7f41-8446-4173-910b-b4b92766c21c.png">
<img width="372" alt="스크린샷 2021-08-04 오후 10 06 25" src="https://user-images.githubusercontent.com/87232411/128187671-7039fd82-1987-4a46-a0cd-e72558161cdb.png">

### Wordpress 웹 접속
```bash
http://EC2_PublicIP/
```

Wordpress 사이트가 만들어졌다 ㅎㅎ
<img width="1365" alt="스크린샷 2021-08-04 오후 10 06 51" src="https://user-images.githubusercontent.com/87232411/128187672-17657319-cd26-4492-8e7e-18077cc24adc.png">

관리자 정보를 입력해준다 -> `워드프레스 설치` 클릭
<img width="828" alt="스크린샷 2021-08-04 오후 10 07 47" src="https://user-images.githubusercontent.com/87232411/128187682-0200a217-ab7a-4f32-902f-ad11f65fb35c.png">

로그인을 해준다
<img width="458" alt="스크린샷 2021-08-04 오후 10 07 59" src="https://user-images.githubusercontent.com/87232411/128187684-fd5b6190-592b-47f6-8651-06199e342e8c.png">

짜쟌
<img width="1436" alt="스크린샷 2021-08-04 오후 10 08 15" src="https://user-images.githubusercontent.com/87232411/128187688-1729847f-f655-4dff-aa43-de5ccdca5510.png">

첫 글을 써보자
<img width="207" alt="스크린샷 2021-08-04 오후 10 08 27" src="https://user-images.githubusercontent.com/87232411/128187693-eac0bf86-3bfd-4bcf-8407-075d28c4e56f.png">

쨔쟌
<img width="1432" alt="스크린샷 2021-08-04 오후 10 09 04" src="https://user-images.githubusercontent.com/87232411/128187694-a4d77e6d-1c1e-4857-9735-7b894d63a4ab.png">

일딴 게시물을 아무거나 작성하자 (웃긴 사진 넣을려다가 저작권 때문에 포오기이 ...)
<img width="990" alt="스크린샷 2021-08-04 오후 10 09 43" src="https://user-images.githubusercontent.com/87232411/128187699-e78e254c-3c8b-4b32-8eef-91a4e60e457e.png">

다 작성 후 -> `공개` 클릭
<img width="131" alt="스크린샷 2021-08-04 오후 10 09 48" src="https://user-images.githubusercontent.com/87232411/128187701-298938c6-22b6-4083-a5b1-be608fe4724a.png">

`공개` 클릭
<img width="278" alt="스크린샷 2021-08-04 오후 10 09 53" src="https://user-images.githubusercontent.com/87232411/128187704-73e6fdef-96f5-4bf3-8580-014f4032aa27.png">

`글 보기` 클릭
<img width="267" alt="스크린샷 2021-08-04 오후 10 09 59" src="https://user-images.githubusercontent.com/87232411/128187705-09b62d29-9932-4354-b7a9-991242a33d2e.png">

오 글이 작성되었다
<img width="1433" alt="스크린샷 2021-08-04 오후 10 10 13" src="https://user-images.githubusercontent.com/87232411/128187707-6ba11b84-5b03-457f-925b-b1985caf83f3.png">

### 외모 변환

`외모` -> `테마` 클릭
<img width="336" alt="스크린샷 2021-08-04 오후 10 10 34" src="https://user-images.githubusercontent.com/87232411/128187709-dd9b9799-256f-48c3-96e5-af854b9a7f85.png">

`새로 추가` 클릭
<img width="262" alt="스크린샷 2021-08-04 오후 10 11 14" src="https://user-images.githubusercontent.com/87232411/128187712-6f3abf15-be2a-493c-ae5b-04b4a440434e.png">

`sydney` 검색
<img width="1271" alt="스크린샷 2021-08-04 오후 10 11 31" src="https://user-images.githubusercontent.com/87232411/128187713-89793214-caf3-4370-90b9-eb7e1fb9d079.png">

`설치` 클릭
<img width="398" alt="스크린샷 2021-08-04 오후 10 11 42" src="https://user-images.githubusercontent.com/87232411/128187720-a4cf52b5-63a3-4ce9-bdd6-d679624f867e.png">

`활성화` 클릭
<img width="402" alt="스크린샷 2021-08-04 오후 10 12 04" src="https://user-images.githubusercontent.com/87232411/128187724-91ad3b14-12d4-404a-a725-c5c09c7d466b.png">

쨘 테마가 바뀌었다
<img width="1437" alt="스크린샷 2021-08-04 오후 10 12 44" src="https://user-images.githubusercontent.com/87232411/128187734-e5b13fec-84d5-43df-96cd-caba4c89648c.png">

### 옵션) 외모 변환 2

Starter Sites 클릭
<img width="685" alt="스크린샷 2021-08-04 오후 10 12 17" src="https://user-images.githubusercontent.com/87232411/128187728-212daba5-4da5-4206-a07e-6503dcf0475f.png">

`Import` 클릭
<img width="440" alt="스크린샷 2021-08-04 오후 10 12 56" src="https://user-images.githubusercontent.com/87232411/128187741-e5e43844-0ddc-4a1a-ad62-10e781f88e71.png">

`Import` 클릭
<img width="212" alt="스크린샷 2021-08-04 오후 10 13 01" src="https://user-images.githubusercontent.com/87232411/128187748-5e5c05cf-04d6-4da9-8e90-bf07a77bf035.png">

`View Site` 클릭
<img width="312" alt="스크린샷 2021-08-04 오후 10 16 10" src="https://user-images.githubusercontent.com/87232411/128187750-ee16bb51-98a6-4278-aac2-b2340141e673.png">

쨘 더 예뻐졌다 
<img width="1435" alt="스크린샷 2021-08-04 오후 10 16 25" src="https://user-images.githubusercontent.com/87232411/128187752-edf97f94-2baf-453e-b576-3907c7f453fc.png">

<br/>
<br/>
<br/>

<hr/>

**참고 자료: AFOS[2기] 노션 내용**



