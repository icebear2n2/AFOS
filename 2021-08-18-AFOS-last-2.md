---
title:  "[AWS] 10주차 -2 AllInOne 인스턴스를 이용하여 CloudFront, ELB, S3(WP Offload Media Lite) 활용"
subtitle:   "AllInOne 인스턴스를 이용하여 CloudFront, ELB, S3(WP Offload Media Lite) 활용"
date: 2021-08-18 13:30:00
categories: AWS
tags: AFOS[2기]
---
## 실습 관련 구성
<img src="/css/images/스크린샷 2021-08-18 오후 2.31.06.png">
<br/>
<br/>

CloudFront -> `ID` 클릭
<img width="410" alt="스크린샷 2021-08-18 오후 1 39 36" src="https://user-images.githubusercontent.com/87232411/129839840-d66f82b1-6bf2-4855-a02e-814fd8c9a9f2.png">

`Domain Name` 확인
<img width="410" alt="스크린샷 2021-08-18 오후 1 40 02" src="https://user-images.githubusercontent.com/87232411/129839847-1a588bd6-d1b2-46c9-b58f-708a63253bb0.png">

EC2 AllnOne 퍼블릭 IP주소로 웹 접속
<img width="1430" alt="스크린샷 2021-08-18 오후 1 41 00" src="https://user-images.githubusercontent.com/87232411/129839851-165783f1-3fa4-48b8-9f32-5d363427b44e.png">

Wordpress 관리자 계정 설정 
<img width="904" alt="스크린샷 2021-08-18 오후 1 41 19" src="https://user-images.githubusercontent.com/87232411/129839860-7a96af38-34e4-4b57-a116-7f7e374f8bbb.png">

로그인
<img width="639" alt="스크린샷 2021-08-18 오후 1 41 31" src="https://user-images.githubusercontent.com/87232411/129839866-2a58d6b1-fc5f-4ade-acda-524f1aea60fe.png">

`설정`으로 들어간다
<img width="78" alt="스크린샷 2021-08-18 오후 1 41 49" src="https://user-images.githubusercontent.com/87232411/129839872-e6302df6-dee8-47fd-a173-e2284e5667df.png">

주소를 CloudFront Domain 주소로 바꿔준다
<img width="668" alt="스크린샷 2021-08-18 오후 1 42 01" src="https://user-images.githubusercontent.com/87232411/129839874-b6134c66-0585-4701-b67d-05200b293f59.png">

https:// 에서 `s`를 빼고 입력한다
<img width="673" alt="스크린샷 2021-08-18 오후 1 42 24" src="https://user-images.githubusercontent.com/87232411/129839876-245e9e4c-1cc9-4253-98c4-173104da1479.png">

`변경사항 저장` 클릭
<img width="220" alt="스크린샷 2021-08-18 오후 1 43 45" src="https://user-images.githubusercontent.com/87232411/129839881-351d6a38-7de7-4eb7-9170-3b79ee73b54b.png">

ALB & 대상 그룹 확인

AllInOne 인스턴스가 포함되어 있다.
<img width="1161" alt="스크린샷 2021-08-18 오후 1 43 25" src="https://user-images.githubusercontent.com/87232411/129839877-3b517f96-f390-409a-9579-5d45fdf6dc20.png">

CloudFront 의 Domain Name 으로 관리자 웹 접속

```
 http://CloudFrontDomainName/wp-admin/
```
<img width="799" alt="스크린샷 2021-08-18 오후 1 44 01" src="https://user-images.githubusercontent.com/87232411/129839882-2cb7737e-8d8c-4f1c-afad-d65673ba756f.png">

CloudFront 의 Domain Name 으로 웹 접속
```
HTTP://CloudFrontDomainName/
```
<img width="585" alt="스크린샷 2021-08-18 오후 1 44 16" src="https://user-images.githubusercontent.com/87232411/129839885-9720642c-e7de-4350-912e-629f2ba2baea.png">

AllInOne 인스턴스 SSH 접속 -> 업로드 폴더 확인

```
cd /var/www/html/wp-content/uploads

# 업로드 폴더 정보 확인
tree
```
<img width="500" alt="스크린샷 2021-08-18 오후 1 45 38" src="https://user-images.githubusercontent.com/87232411/129839891-2215e5bd-45c3-4a2c-ad0a-b58ad3d09618.png">


글 -> `새로 추가` 클릭
<img width="148" alt="스크린샷 2021-08-18 오후 1 46 48" src="https://user-images.githubusercontent.com/87232411/129839894-bc20b689-9962-46b0-82bf-7e4ff04b80e6.png">
<img width="251" alt="스크린샷 2021-08-18 오후 1 46 55" src="https://user-images.githubusercontent.com/87232411/129839896-cec12b2f-0ba3-4d2b-a59d-79b4b2e51891.png">

글 작성 후 `공개` 클릭

<img width="281" alt="스크린샷 2021-08-18 오후 1 47 57" src="https://user-images.githubusercontent.com/87232411/129839900-eda95ff6-4ac9-40bb-a793-ab10f76cf591.png">

`공개` 클릭
<img width="292" alt="스크린샷 2021-08-18 오후 1 48 01" src="https://user-images.githubusercontent.com/87232411/129839902-94500a68-43c2-4e3e-8933-8033002d36f0.png">

제 성격이 보이는 이모티콘 입니다 ㅎ
<img width="1435" alt="스크린샷 2021-08-18 오후 1 48 16" src="https://user-images.githubusercontent.com/87232411/129839903-25f2fe9a-dee3-432e-b0c2-c0faa61273e3.png">

워드프레스에 글 작성 후 AllInOne의 업로드 폴더 확인
```
tree
```
<img width="694" alt="스크린샷 2021-08-18 오후 1 48 37" src="https://user-images.githubusercontent.com/87232411/129839906-0380a878-0aa2-4276-926c-4da564493a65.png">

### 업로드 저장소를 S3로 변경하여 저장 및 파일 제공 최적화

플러그인 -> 새로 추가 클릭

<img width="327" alt="스크린샷 2021-08-18 오후 1 48 55" src="https://user-images.githubusercontent.com/87232411/129839912-cafcd44b-ff9b-4588-8f72-0d5b33ac44b3.png">

`WP Offload Media Lite` 검색 후 설치
<img width="635" alt="스크린샷 2021-08-18 오후 1 49 15" src="https://user-images.githubusercontent.com/87232411/129839913-b9ed2850-23d5-4b3f-a165-b601560c10eb.png">

`활성화` 클릭 -> `Settings` 클릭
<img width="249" alt="스크린샷 2021-08-18 오후 1 50 11" src="https://user-images.githubusercontent.com/87232411/129839916-f64221b3-8145-46d3-a457-a46a57306f22.png">

아래 중간 선택 후 하단 `NEXT` 선택
<img width="685" alt="스크린샷 2021-08-18 오후 1 50 27" src="https://user-images.githubusercontent.com/87232411/129839921-91bd602f-3bcd-4d08-acb7-7403dbe91d38.png">

`Create new bucket` 클릭
<img width="180" alt="스크린샷 2021-08-18 오후 1 50 34" src="https://user-images.githubusercontent.com/87232411/129839926-aa1a65e4-29d6-4673-90f8-c4a87064c05c.png">

Region 선택 -> Bucket 이름 작성 -> `Create New Bucket` 클릭
<img width="684" alt="스크린샷 2021-08-18 오후 1 50 45" src="https://user-images.githubusercontent.com/87232411/129839928-cc1b5a45-74da-4e4d-ac59-6c80874f07d3.png">

하단의 `ADBANCED OPTIONS` ON으로 클릭 -> `Save Changes` 클릭 
<img width="694" alt="스크린샷 2021-08-18 오후 1 51 12" src="https://user-images.githubusercontent.com/87232411/129839932-35c150e5-fe9b-4f33-ab38-d1ac471a3e7a.png">

두 번째 글 작성 -> `공개` 클릭
<img width="277" alt="스크린샷 2021-08-18 오후 1 53 12" src="https://user-images.githubusercontent.com/87232411/129839938-d9b5979f-ec60-4672-abfe-00aa6ac2dfd7.png">

`공개` 클릭
<img width="286" alt="스크린샷 2021-08-18 오후 1 53 17" src="https://user-images.githubusercontent.com/87232411/129839941-66ec3400-7f70-4970-afff-3abef49d8a30.png">

잘 찍었죠 ?
<img width="1439" alt="스크린샷 2021-08-18 오후 1 53 56" src="https://user-images.githubusercontent.com/87232411/129839942-b73582ab-63d9-4388-8182-c640c7144b3a.png">

S3 -> 만든 버킷 클릭
<img width="464" alt="스크린샷 2021-08-18 오후 1 54 38" src="https://user-images.githubusercontent.com/87232411/129839966-4a4546fa-e84a-4590-ba61-4ba45361db4c.png">

사진이 나올 때까지 계속 클릭 해줍니다
<img width="409" alt="스크린샷 2021-08-18 오후 1 54 45" src="https://user-images.githubusercontent.com/87232411/129839967-1c2c1cae-e56f-48ad-a37a-73db330c21eb.png">
<img width="400" alt="스크린샷 2021-08-18 오후 1 54 51" src="https://user-images.githubusercontent.com/87232411/129839969-1b4862e6-f827-41ca-8232-6fd96c72460a.png">
<img width="378" alt="스크린샷 2021-08-18 오후 1 54 54" src="https://user-images.githubusercontent.com/87232411/129839970-5fb8bd47-66ec-4288-9564-3c7970edcb52.png">
<img width="372" alt="스크린샷 2021-08-18 오후 1 54 57" src="https://user-images.githubusercontent.com/87232411/129839972-7829ee0c-7496-47f1-b116-4ad9beb122ed.png">
<img width="396" alt="스크린샷 2021-08-18 오후 1 55 02" src="https://user-images.githubusercontent.com/87232411/129839973-b7bd94e9-7fd0-4c42-bf61-29d9423e0214.png">

사진이 S3 버킷에 저장이 되었습니다
<img width="753" alt="스크린샷 2021-08-18 오후 1 55 10" src="https://user-images.githubusercontent.com/87232411/129839975-4c9e8b96-bfa8-4bfa-af98-8480419a3933.png">

AllInOne의 업로드 폴더에 이미지 존재 여부 확인, S3 버킷에 저장된 내용 확인
```
# 기존 파일만 존재
tree /var/www/html/wp-content/upload

# S3 버킷에 저장된 내용 확인
aws s3 ls s3://<자신의 버킷 이름> --recursive
aws s3 ls s3://beaswp --recursive
```
<img width="481" alt="스크린샷 2021-08-18 오후 1 56 04" src="https://user-images.githubusercontent.com/87232411/129839981-947c44da-a105-4dc9-aba0-260f3bd8b20c.png">
<img width="619" alt="스크린샷 2021-08-18 오후 1 56 45" src="https://user-images.githubusercontent.com/87232411/129839984-204daa1b-6af0-4c72-829c-ef77360d1180.png">

### 옵션) S3 버킷 설정

버킷 -> 권한 클릭
<img width="383" alt="스크린샷 2021-08-18 오후 1 57 10" src="https://user-images.githubusercontent.com/87232411/129839988-eca74b99-79b3-4e56-ac64-86cec8dfa785.png">

버킷 정책에서 `편집` 클릭
<img width="1067" alt="스크린샷 2021-08-18 오후 1 57 20" src="https://user-images.githubusercontent.com/87232411/129839989-add9e165-9093-42a0-a6bd-b8f259d3dacc.png">

붙여놓기 후 자신의 버킷 이름 -> 변경
```JSON
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": [
        "s3:GetObject"
        ],
      "Resource": [
        "arn:aws:s3:::자신의버킷이름/*"
        ]
    }
  ]
```
<img width="883" alt="스크린샷 2021-08-18 오후 1 58 23" src="https://user-images.githubusercontent.com/87232411/129839996-5e2b85aa-47e5-4174-8128-636686285237.png">

`변경 사항 저장` 클릭
<img width="253" alt="스크린샷 2021-08-18 오후 1 58 27" src="https://user-images.githubusercontent.com/87232411/129840000-b9951651-a017-4f75-911f-070b5a6ba456.png">

실습 끝
<img width="340" alt="스크린샷 2021-08-18 오후 1 58 34" src="https://user-images.githubusercontent.com/87232411/129840004-7a618aa7-a312-4627-8c9a-4c7926b2c49e.png">
<br/>
<br/>

## 다음 실습을 위해 해야 할 사항
AllInOne 인스턴스 중지
S3 버킷 초기화: S3 버킷 -> 비어있음 -> `영구 삭제` 입력 -> `비어있음` 클릭 -> `종료` 클릭

<br/>
<br/>
<br/>

<hr/>

**참고 자료: AFOS[2기] 노션 내용**