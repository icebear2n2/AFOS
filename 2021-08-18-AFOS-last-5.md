---
title:  "[AWS] 10주차 -5 장애 발생 및 지속 서비스 확인"
subtitle:   "장애 발생 및 지속 서비스 확인"
date: 2021-08-18 15:35:00
categories: AWS
tags: AFOS[2기]
---

## RDS DB Primary 장애

### 구성
![스크린샷 2021-08-20 오후 11 19 37](https://user-images.githubusercontent.com/87232411/130247635-ea8dd0ac-56ee-4096-89dc-9129c3b00ac6.png)
<br/>
<br/>

RDS -> 작업 -> 재부팅
<img width="1133" alt="스크린샷 2021-08-20 오후 10 04 11" src="https://user-images.githubusercontent.com/87232411/130241478-287053f5-147a-4783-9af6-2db77b77b88d.png">

`장애 조치 ~` 클릭 -> `확인` 클릭
<img width="838" alt="스크린샷 2021-08-20 오후 10 04 19" src="https://user-images.githubusercontent.com/87232411/130241483-ec470115-47fc-4afe-8c62-39851b0871c5.png">

지켜봅시다.
<img width="921" alt="스크린샷 2021-08-20 오후 10 08 43" src="https://user-images.githubusercontent.com/87232411/130241488-64052901-16b8-4e62-a0bf-55f89654327e.png">

한번 더 재부팅 시켜줍니다
<img width="1194" alt="스크린샷 2021-08-20 오후 10 10 08" src="https://user-images.githubusercontent.com/87232411/130241492-c2982d88-6b72-4eaf-81af-2562a7f41eeb.png">
<img width="802" alt="스크린샷 2021-08-20 오후 10 10 15" src="https://user-images.githubusercontent.com/87232411/130241499-b06da051-2339-45b4-bc72-3699e02e7110.png">

IP주소가 4점대로 바뀌었습니다
<img width="479" alt="스크린샷 2021-08-20 오후 10 13 08" src="https://user-images.githubusercontent.com/87232411/130241504-9b8c6405-0ec5-4e88-9b8b-6c1f2ea7d143.png">
<img width="414" alt="스크린샷 2021-08-20 오후 10 10 52" src="https://user-images.githubusercontent.com/87232411/130241503-5616fbbd-6226-4ecf-91fc-d2610b432bfc.png">

정상적으로 DB 접근이 됩니다
<img width="1436" alt="스크린샷 2021-08-20 오후 10 14 04" src="https://user-images.githubusercontent.com/87232411/130241508-47a6a5c8-4a9d-4bd9-a029-228f034aee7c.png">

리전은 a영역, 보조 영역은 c영역입니다
<img width="228" alt="스크린샷 2021-08-20 오후 10 14 57" src="https://user-images.githubusercontent.com/87232411/130241517-d803959f-c0ae-4cac-a0b2-47ab5eec54fe.png">
<img width="218" alt="스크린샷 2021-08-20 오후 10 15 01" src="https://user-images.githubusercontent.com/87232411/130241518-46c7c935-5c65-46e6-9d92-aa75f9094d96.png">

## AZ1 장애

### 구성
![스크린샷 2021-08-20 오후 11 19 56](https://user-images.githubusercontent.com/87232411/130247643-8da8661e-0706-4c7e-b5ee-364e44c118e5.png)
<br/>
<br/>

WebSrv-Leader 인스턴스에서 지속적인 접속 확인

```bash
# 지속적으로 접속 확인
while true; do curl $WPDNS/xff.php --silent --connect-timeout 1; date; echo "---[AutoScaling]---"; sleep 1; done

(옵션)
for i in {1..100}; do curl $WPDNS/xff.php --silent;echo ; done | sort | uniq -c | sort -nr
```
<img width="893" alt="스크린샷 2021-08-20 오후 10 17 11" src="https://user-images.githubusercontent.com/87232411/130241519-bbe77541-f91f-4b56-941e-128b82b8a131.png">

VPC -> 네트워크 ACL 클릭
<img width="172" alt="스크린샷 2021-08-20 오후 10 17 56" src="https://user-images.githubusercontent.com/87232411/130241523-b639d556-dd87-4360-9377-8e4aba2015cc.png">

`네트워크 ACL 생성` 클릭
<img width="339" alt="스크린샷 2021-08-20 오후 10 18 08" src="https://user-images.githubusercontent.com/87232411/130241524-a1502d31-41cc-40bb-a793-ad8c0056ddf2.png">
```bash
이름: AllDeny
VPC: WP-VPC1
태그: Name, AllDeny
```
<img width="869" alt="스크린샷 2021-08-20 오후 10 18 21" src="https://user-images.githubusercontent.com/87232411/130241525-69ccf0f5-ab04-4c5c-b7c4-29c1a22ac76f.png">

`네트워크 ACL 생성` 클릭
<img width="853" alt="스크린샷 2021-08-20 오후 10 19 07" src="https://user-images.githubusercontent.com/87232411/130241529-8a2b51d5-7750-4248-82b6-0b860012d176.png">

작업 -> `서브넷 연결 편집` 클릭
<img width="1086" alt="스크린샷 2021-08-20 오후 10 19 18" src="https://user-images.githubusercontent.com/87232411/130241533-e451f8b2-ee6f-4823-ae90-a5f6df2521ff.png">

Subnet1, 3 선택 -> `변경 사항 저장` 클릭
<img width="1360" alt="스크린샷 2021-08-20 오후 10 19 33" src="https://user-images.githubusercontent.com/87232411/130241536-11d33ee1-cc75-4072-97d0-94856f5fa552.png">

a 영역은 타겟그룹에서 제외되고 있습니다
<img width="1162" alt="스크린샷 2021-08-20 오후 10 23 42" src="https://user-images.githubusercontent.com/87232411/130241553-92af4cf7-6abc-4c3a-8ff9-94a8db699235.png">

부하분산되어지는 걸 확인하며 AutoScaling이 정상적으로 작동하는 걸 알 수 있습니다
<img width="925" alt="스크린샷 2021-08-20 오후 10 25 12" src="https://user-images.githubusercontent.com/87232411/130241560-b638afc9-e518-4523-87cb-ebbdb0481f15.png">
<img width="840" alt="스크린샷 2021-08-20 오후 10 25 29" src="https://user-images.githubusercontent.com/87232411/130241567-90a43d8f-dabd-412b-a670-6527d806bcc4.png">

## 자원 삭제

### 1. RDS 삭제: 최종 스냅샷 언체크 -> 인스턴스 삭제 시 ~ 체크 !
### 2. EC2 AutoScalingGroup 삭제
### 3. S3 버킷 -> 삭제 -> 비우기 -> 삭제
### 4. EC2 시작 템플릿 삭제
### 5. 위 자원들 전부 삭제 후 -> CloudFormation 스택 삭제

<br/>
<br/>
<br/>

<hr/>

**참고 자료: AFOS[2기] 노션 내용**